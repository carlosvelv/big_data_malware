
# Utilizando Spark para la clasificación de Malware

## Autores 
* Adilene Calderón
* Carlos Velázquez
* Martha Juárez
* Paola Vélez

## Contexto del problema

El malware (o software malicioso) es un software diseñado para dañar a los usuarios, las organizaciones y los sistemas informáticos y de telecomunicaciones. Más concretamente, el malware puede bloquear la conexión a Internet, corromper un sistema operativo, robar la contraseña y otra información privada de un usuario.<sup>1</sup>Durante la última década, el Machine Learning ha provocado un cambio radical en muchos sectores, incluido el de la ciberseguridad. Existe la creencia generalizada entre los expertos en ciberseguridad de que las herramientas antimalware potenciadas por Machine learning ayudarán a detectar los ataques de malware modernos y a mejorar los motores de escaneo.<sup>2</sup>

Los n-gramas de bytes se han utilizado previamente como características en una serie de trabajos, y son uno de los tipos de características más comunes utilizados para el análisis estático de malware.<sup>3</sup>
Los n-gramas de bytes son especialmente atractivos, ya que no necesitan conocer el formato del archivo, no requieren ningún análisis dinámico y podrían aprender información tanto de las cabeceras como de las secciones de código binario de un ejecutable. El hecho de que el enfoque de los n-gramas no requiera un conocimiento del dominio significa que un sistema de n-gramas de bytes podría utilizarse para otros formatos de archivo, como los PDF.<sup>4</sup>

En este problema utilizaremos el dataset de Microsoft Malware Classification Challenge (BIG 2015), en conjunto con tecnologías tales como Spark y Hadoop, con el fin de realizar la clasificación de Malware en un contexto de Big Data. El dataset de Clasificación de Malware de Microsoft se anunció en 2015 junto con la publicación de un enorme conjunto de datos de casi 0,5 terabytes, compuesto por el desensamblaje y el código de bytes de más de 20 000 muestras de malware.
Este dataset es un conjunto de archivos de malware conocidos que representan una mezcla de 9 familias de malware diferentes. Cada archivo de malware tiene un Id, un valor hash de 20 caracteres que identifica de forma exclusiva el archivo, y una Clase (un número entero que representa uno de los 9 nombres de familia a los que puede pertenecer el malware):

1) Ramnit: Gusano informático que afecta a los usuarios de Windows.
2) Lollipop: Adware muestra anuncios mientras navegas por la web. También puede redirigir los resultados de su motor de búsqueda, controlar lo que hace en su PC, descargar aplicaciones y enviar información sobre su PC a un hacker.
3) Kelihos_ver3:  Botnet dedicado principalmente al spam y al robo de bitcoins.
4) Vundo: Troyanos estrechamente asociados con el programa adware que descarga y muestra anuncios emergentes.
5) Simda:  Malware que una vez instalados en una máquina, pueden ser controlados remotamente por un atacante para que realicen diversas acciones, las más comunes son el robo de datos personales o del sistema, la realización de capturas de pantalla y la descarga de archivos adicionales en el sistema. Las máquinas infectadas se agrupan en una botnet.
6) Tracur: familia de troyanos que redirigen las búsquedas en la web. Lo hacen para que los autores del malware obtengan ingresos mediante el fraude publicitario en línea.
7) Kelihos_ver1: versión 1 del botnet dedicado principalmente al spam y al robo de bitcoins.
8) Obfuscator.ACY: familia de virus que ocultan su propósito a través de varias técnicas de ofuscación.
9) Gatak: Familia de troyanos que crea un backdoor en la máquina comprometida y luego roba datos sensibles y se propaga a través de la red objetivo infectando otros dispositivos.



## Realizado con:
* [Python](https://www.python.org/)
* [PySpark](https://spark.apache.org/docs/latest/api/python/)
* [Parquet](https://parquet.apache.org/)
* [Apache Arrow](https://arrow.apache.org/)



## Roadmap

- [ ] Creación del repositorio
- [ ] Descarga y extracción de archivos
- [ ] Extracción de caracteristicas y generación de CSV
- [ ] Transformación de CSV a .parquet
- [ ] Generación de datos de entrenamiento y datos de prueba
- [ ] Análisis de datos exploratorio
- [ ] Generación de modelos y optimización de hiperparametros
- [ ] Evaluación y selección de modelo
- [ ] Exportacion de modelo


## Estructura del repositorio
==============================
------------

    ├── LICENSE 
    ├── datasets
    │   ├── diccionarios_de_datos  <- Directorio que contiene los diccionarios de datos
    │   ├── malware_data_rev2.csv   <- Archivo .csv con las caracteristicas extraidas de los archivos maliciosos.
    │   ├── malware_data_rev2.parquet   <- Archivo .parquet con las caracteristicas extraidas de los archivos maliciosos.
    │   ├── test.csv  <- Archivo .csv con el conjunto de datos de prueba.
    │   ├── test.parquet  <- Archivo .parquet con el conjunto de datos de prueba.
    │   ├── train.csv   <- Archivo .csv con el conjunto de datos de entrenamiento.
    │   ├── train.parquet   <- Archivo .parquet con el conjunto de datos de entrenamiento.
    │   ├── file_size_data.csv <- Archivo .csv con las clases y tamaños de archivo de cada malware.
    │   └── unigrams_completo.csv  <- The final, canonical data sets for modeling.
    │
    ├── procesamiento_datos
    │   ├── csv_to_parquet_pyarrow.ipynb  <- Notebook con la transformación de archivo csv a parquet.
    │   ├── data_merging.ipynb   <- Notebook con la unión de los datasets de peso de archivo y los unigramas.
    │   ├── descarga_extraccion_datos.ipynb  <- Notebook con lo relacionado a la descarga y extracción de los datos con Kaggle.
    │   ├── limpieza_extraccion_caracteristicas.ipynb  <- Notebook con la limpieza de datos crudos y extracción de unigramas.
    │   └── train_test_split.ipynb   <- Notebook con la generación de conjuntos de datos de prueba y entranamiento.
    │
    ├── modelos
    │   ├── best_model <- directorio con los metadatos del mejor modelo
    │   └──  generacion_evaluacion_modelos.ipynb   <- Notebook con la generación de los modelos.
    │    
    │
    └── requirements.txt   <- El archivo de requisitos para reproducir el entorno de análisis


--------

## Referencias
1 - Malware classification and composition analysis: A survey of recent developments - https://www.sciencedirect.com/science/article/pii/S2214212621000648

2 - The rise of machine learning for detection and classification of malware: Research developments, trends and challenges - https://www.sciencedirect.com/science/article/pii/S1084804519303868

3 - Detection of malicious code by applying machine learning classifiers on static features: A state-of-the-art survey - https://www.sciencedirect.com/science/article/abs/pii/S1363412709000041

4 - An investigation of byte n-gram features for malware classification - https://link.springer.com/article/10.1007/s11416-016-0283-1
